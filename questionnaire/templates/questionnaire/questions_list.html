{% extends "home/homepage.html" %}

{% block content %}
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<<<<<<< HEAD
=======
    <script>
        document.cookie = "csrftoken={{ csrf_token }}";
    </script>
>>>>>>> 9bb57c1 (Updated project files with latest changes)
</head>

<div class="container mt-5">
    <!-- Dropdown to Select Track -->
    <div class="form-group">
        <label for="interest">Select the track you want to take the quiz for:</label>
        <select name="interest" id="interest" class="form-control">
            <option value="" disabled selected>Select a track</option>
            <option value="1">Artificial Intelligence</option>
            <option value="2">Web Development</option>
            <option value="3">Network</option>
            <option value="4">Mobile App Development</option>
            <option value="5">Data Science</option>
            <option value="6">Data Engineering</option>
            <option value="7">Cybersecurity</option>
            <option value="8">Robotics</option>
        </select>
    </div>

    <!-- Questions Container -->
    <div id="questions-container" class="row mt-5">
        {% if questions %}
            {% for question in questions %}
<<<<<<< HEAD
                <div class="col-md-12 mb-4 question-card" data-trackid="{{ question.trackid }}" style="display: none;">
                    <div class="card">
=======
            <div class="col-md-12 mb-4 question-card" data-questionid="{{ question.id }}" data-trackid="{{ question.trackid }}" style="display: none;">
                <div class="card">
>>>>>>> 9bb57c1 (Updated project files with latest changes)
                        <div class="card-body">
                            <h5 class="card-title">{{ question.question }}</h5>
                            <form>
                                <div class="form-check">
                                    <input type="radio" id="option_a_{{ forloop.counter0 }}" name="answer_{{ forloop.counter0 }}" class="form-check-input" value="A">
                                    <label class="form-check-label" for="option_a_{{ forloop.counter0 }}">A: {{ question.option_a }}</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" id="option_b_{{ forloop.counter0 }}" name="answer_{{ forloop.counter0 }}" class="form-check-input" value="B">
                                    <label class="form-check-label" for="option_b_{{ forloop.counter0 }}">B: {{ question.option_b }}</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" id="option_c_{{ forloop.counter0 }}" name="answer_{{ forloop.counter0 }}" class="form-check-input" value="C">
                                    <label class="form-check-label" for="option_c_{{ forloop.counter0 }}">C: {{ question.option_c }}</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" id="option_d_{{ forloop.counter0 }}" name="answer_{{ forloop.counter0 }}" class="form-check-input" value="D">
                                    <label class="form-check-label" for="option_d_{{ forloop.counter0 }}">D: {{ question.option_d }}</label>
                                </div>
                            </form>
                            <p class="mt-3"><strong>Difficulty Level:</strong> {{ question.q_level }}</p>
                            <p><strong>Course Name:</strong> {{ question.course_name }}</p>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p>No questions available.</p>
        {% endif %}
    </div>

    <!-- Navigation Buttons -->
    <div class="d-flex justify-content-between mt-4">
        <button id="prev-btn" class="btn btn-secondary" disabled>Previous</button>
        <button id="next-btn" class="btn btn-primary" disabled>Next</button>
    </div>

    <!-- Submit Button -->
    <div id="submit-container" class="mt-4" style="display: none;">
        <form method="get" action="{% url 'questionnaire_completed' %}">
<<<<<<< HEAD
            <button id="submit-quiz" type="submit" id="submit-btn" class="btn btn-primary" style="background-color: #89CFF0; color: darkblue;">
                Submit
            </button>
=======
            <button type="button" onclick="submitAnswer()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</button>
>>>>>>> 9bb57c1 (Updated project files with latest changes)
        </form>
    </div>
</div>

<script>
<<<<<<< HEAD
 document.addEventListener("DOMContentLoaded", function () {
    const trackSelect = document.getElementById('interest');
    const questionCards = document.querySelectorAll('.question-card');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const submitContainer = document.getElementById('submit-container');
    const submitButton = document.getElementById('submit-quiz');
    let currentIndex = 0;
    let visibleQuestions = [];

    // ÙÙ„ØªØ±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù€ track Ø§Ù„Ù…Ø­Ø¯Ø¯
    trackSelect.addEventListener("change", function () {
        const selectedTrackId = this.value;

        // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø£ÙˆÙ„Ù‹Ø§
        questionCards.forEach((card) => {
            card.style.display = "none";
        });

        // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù€ track Ø§Ù„Ù…Ø­Ø¯Ø¯
        visibleQuestions = Array.from(questionCards).filter(
            (card) => card.dataset.trackid === selectedTrackId
        );

        // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„ØªÙ†Ù‚Ù„
        currentIndex = 0;
        if (visibleQuestions.length > 0) {
            updateQuestionDisplay();
            prevBtn.disabled = true;
            nextBtn.disabled = false;
        } else {
            prevBtn.disabled = true;
            nextBtn.disabled = true;
            submitContainer.style.display = "none";
        }
    });

    function updateQuestionDisplay() {
        visibleQuestions.forEach((card, index) => {
            card.style.display = index === currentIndex ? "block" : "none";
        });

        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = currentIndex === visibleQuestions.length - 1;

        // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙÙŠ Ø¢Ø®Ø± Ø³Ø¤Ø§Ù„
        submitContainer.style.display =
            currentIndex === visibleQuestions.length - 1 ? "block" : "none";
    }

    prevBtn.addEventListener("click", function () {
        if (currentIndex > 0) {
            currentIndex--;
            updateQuestionDisplay();
        }
    });

    nextBtn.addEventListener("click", function () {
        if (currentIndex < visibleQuestions.length - 1) {
            currentIndex++;
            updateQuestionDisplay();
        }
    });

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±
    submitButton.addEventListener('click', function () {
        const answers = [];
        let allAnswered = true;

        visibleQuestions.forEach((card) => {
            const questionId = card.getAttribute('data-questionid');  // ØªØ¹Ø¯ÙŠÙ„ Ù„Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ù…Ø¹Ø±Ù Ø§Ù„ØµØ­ÙŠØ­
            const selectedOption = card.querySelector('input[type="radio"]:checked');

            if (selectedOption) {
                answers.push({
                    question_id: questionId,
                    answer: selectedOption.value
                });
            } else {
                allAnswered = false;
            }
        });

        if (!allAnswered) {
            alert("ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.");
            return;
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±
        fetch('/submit-quiz/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCSRFToken()
            },
            body: JSON.stringify({ answers })
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
        })
        .catch(error => console.error('Error:', error));
    });

    // Ø¬Ù„Ø¨ CSRF Token Ù…Ù† Ø§Ù„ÙƒÙˆÙƒÙŠØ²
    function getCSRFToken() {
        return document.cookie.split('; ')
            .find(row => row.startsWith('csrftoken'))
            ?.split('=')[1];
    }
});

</script>
{% endblock %}
=======
    document.addEventListener("DOMContentLoaded", function () {
        const trackSelect = document.getElementById('interest');
        const questionCards = document.querySelectorAll('.question-card');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitContainer = document.getElementById('submit-container');
        const submitButton = document.getElementById('submit-quiz');
        let currentIndex = 0;
        let visibleQuestions = [];
    
        // ÙÙ„ØªØ±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù€ track Ø§Ù„Ù…Ø­Ø¯Ø¯
        trackSelect.addEventListener("change", function () {
            const selectedTrackId = this.value;
    
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø£ÙˆÙ„Ù‹Ø§
            questionCards.forEach((card) => {
                card.style.display = "none";
            });
    
            // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù€ track Ø§Ù„Ù…Ø­Ø¯Ø¯
            visibleQuestions = Array.from(questionCards).filter(
                (card) => card.dataset.trackid === selectedTrackId
            );
    
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„ØªÙ†Ù‚Ù„
            currentIndex = 0;
            if (visibleQuestions.length > 0) {
                updateQuestionDisplay();
                prevBtn.disabled = true;
                nextBtn.disabled = false;
            } else {
                prevBtn.disabled = true;
                nextBtn.disabled = true;
                submitContainer.style.display = "none";
            }
        });
    
        function updateQuestionDisplay() {
            visibleQuestions.forEach((card, index) => {
                card.style.display = index === currentIndex ? "block" : "none";
            });
    
            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex === visibleQuestions.length - 1;
    
            // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙÙŠ Ø¢Ø®Ø± Ø³Ø¤Ø§Ù„
            submitContainer.style.display = (currentIndex === visibleQuestions.length - 1) ? "block" : "none";
        }
    
        prevBtn.addEventListener("click", function () {
            if (currentIndex > 0) {
                currentIndex--;
                updateQuestionDisplay();
            }
        });
    
        nextBtn.addEventListener("click", function () {
            if (currentIndex < visibleQuestions.length - 1) {
                currentIndex++;
                updateQuestionDisplay();
            }
        });
        function submitAnswers(answersList) {
    fetch('/submit-answer/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')  // ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø±Ø³Ø§Ù„ CSRF Token
        },
        body: JSON.stringify({
            answers: answersList
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.message) {
            alert(data.message);
        } else {
            alert('Ø®Ø·Ø£: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

// Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ CSRF Token Ù…Ù† Ø§Ù„ÙƒÙˆÙƒÙŠØ²
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        let cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            let cookie = cookies[i].trim();
            if (cookie.startsWith(name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±
        if (submitButton) {
            submitButton.addEventListener('click', function () {
                const answers = [];
                let allAnswered = true;
    
                visibleQuestions.forEach((card) => {
                    const questionId = card.getAttribute('data-questionid');  
                    const selectedOption = card.querySelector('input[type="radio"]:checked');
    
                    if (selectedOption) {
                        answers.push({
                            question_id: questionId,
                            answer: selectedOption.value
                        });
                    } else {
                        allAnswered = false;
                    }
                });
    
                if (!allAnswered) {
                    alert("ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.");
                    return;
                }
    
                // ØªØªØ¨Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                console.log("ðŸ”µ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±:", answers);
    
                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±
                fetch('/submit-quiz/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    },
                    body: JSON.stringify({ answers })
                })
                .then(response => {
                    console.log("ðŸŸ¢ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­. Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø¯...");
                    return response.json();
                })
                .then(data => {
                    console.log("ðŸŸ¢ Ø±Ø¯ Ø§Ù„Ø³ÙŠØ±ÙØ±:", data);
                    alert(data.message);
                })
                .catch(error => {
                    console.error('ðŸ”´ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                });
            });
        } else {
            console.error("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ submit-quiz");
        }
    
        // Ø¬Ù„Ø¨ CSRF Token Ù…Ù† Ø§Ù„ÙƒÙˆÙƒÙŠØ² Ø£Ùˆ Ù…Ù† Ø§Ù„Ù…Ø¯Ø®Ù„ Ø§Ù„Ù…Ø®ÙÙŠ
        function getCSRFToken() {
            let csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value;
            if (!csrfToken) {
                csrfToken = document.cookie.split('; ').find(row => row.startsWith('csrftoken'))?.split('=')[1];
            }
            console.log("ðŸŸ¡ CSRF Token:", csrfToken);
            return csrfToken;
        }
    });
    </script>
{% endblock %}
>>>>>>> 9bb57c1 (Updated project files with latest changes)
